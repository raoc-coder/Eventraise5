"use strict";(()=>{var e={};e.id=360,e.ids=[360],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},8681:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>g,originalPathname:()=>_,patchFetch:()=>x,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>I});var o={};r.r(o),r.d(o,{GET:()=>p});var a=r(5419),n=r(9108),s=r(9678),i=r(8070),d=r(8234),u=r(2409);async function p(e){try{let t=e.headers.get("authorization");if(!t||!t.startsWith("Bearer "))return i.Z.json({error:"Unauthorized: Missing or invalid authorization header"},{status:401});let r=t.split(" ")[1],o=(0,u.eI)("https://yxzypekwyuopbanroobr.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}}),{data:{user:a},error:n}=await o.auth.getUser(r);if(n||!a)return i.Z.json({error:"Unauthorized: Invalid token"},{status:401});let{data:s}=await o.from("profiles").select("is_admin").eq("id",a.id).single();if(!s?.is_admin)return i.Z.json({error:"Forbidden: Admin access required"},{status:403});let{searchParams:p}=new URL(e.url),c=p.get("campaign_id"),l=p.get("start_date"),m=p.get("end_date"),h=p.get("format")||"csv";if(!d.O)return i.Z.json({error:"Database not configured"},{status:500});let g=d.O.from("donations").select(`
        id,
        amount,
        donor_name,
        donor_email,
        status,
        created_at,
        campaigns(title, organizer_id)
      `).eq("status","completed");c&&(g=g.eq("campaign_id",c)),l&&(g=g.gte("created_at",l)),m&&(g=g.lte("created_at",m));let{data:I,error:_}=await g.order("created_at",{ascending:!1});if(_)return console.error("Error fetching donations:",_),i.Z.json({error:"Failed to fetch donation data"},{status:500});if(console.log(`Admin export requested by user ${a.id}:`,{campaignId:c,startDate:l,endDate:m,format:h,recordCount:I?.length||0}),"csv"===h){let e=I?.map(e=>[e.id,e.amount,e.donor_name||"Anonymous",e.donor_email||"",e.campaigns?.title||"",e.status,new Date(e.created_at).toISOString()])||[],t=["Donation ID,Amount,Donor Name,Donor Email,Campaign Title,Status,Date",...e.map(e=>e.map(e=>`"${e}"`).join(","))].join("\n");return new i.Z(t,{status:200,headers:{"Content-Type":"text/csv","Content-Disposition":`attachment; filename="donations-export-${new Date().toISOString().split("T")[0]}.csv"`}})}return i.Z.json({success:!0,data:I,meta:{total:I?.length||0,exported_at:new Date().toISOString(),exported_by:a.id}})}catch(e){return console.error("Export error:",e),i.Z.json({error:"Internal server error"},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/export-donors/route",pathname:"/api/admin/export-donors",filename:"route",bundlePath:"app/api/admin/export-donors/route"},resolvedPagePath:"/Users/raoc/Documents/GitHub/Eventraise/app/api/admin/export-donors/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:h,headerHooks:g,staticGenerationBailout:I}=c,_="/api/admin/export-donors/route";function x(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},8234:(e,t,r)=>{r.d(t,{O:()=>s});var o=r(2409);let a="https://yxzypekwyuopbanroobr.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl4enlwZWt3eXVvcGJhbnJvb2JyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0NjI3NDksImV4cCI6MjA3NDAzODc0OX0.37JNu4brGevL3VDd9In3vxSFY49Jw6CtMZw5SZ6uaEA",s=a&&n?(0,o.eI)(a,n):null;a&&process.env.SUPABASE_SERVICE_ROLE_KEY&&(0,o.eI)(a,process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[638,206,409],()=>r(8681));module.exports=o})();