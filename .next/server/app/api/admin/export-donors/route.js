try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="37100849-3655-46c6-9b90-f9e4efedf2c6",e._sentryDebugIdIdentifier="sentry-dbid-37100849-3655-46c6-9b90-f9e4efedf2c6")}()}catch(e){}"use strict";(()=>{var e={};e.id=3360,e.ids=[3360,2982],e.modules={58097:e=>{e.exports=require("@sentry/nextjs")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},14609:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>T,originalPathname:()=>O,patchFetch:()=>P,requestAsyncStorage:()=>A,routeModule:()=>_,serverHooks:()=>D,staticGenerationAsyncStorage:()=>w,staticGenerationBailout:()=>q});var o={};r.r(o),r.d(o,{DELETE:()=>b,GET:()=>h,HEAD:()=>v,OPTIONS:()=>x,PATCH:()=>E,POST:()=>I,PUT:()=>S,dynamic:()=>l});var n=r(11450),a=r(43258),s=r(28395),i=r(54580),d=r(6780),u=r(72982),p=r(27354),c=r(58097);let l="force-dynamic";async function m(e){try{let t=e.headers.get("authorization");if(!t||!t.startsWith("Bearer "))return d.Z.json({error:"Unauthorized: Missing or invalid authorization header"},{status:401});let r=t.split(" ")[1],o=(0,p.eI)("https://yxzypekwyuopbanroobr.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}}),{data:{user:n},error:a}=await o.auth.getUser(r);if(a||!n)return d.Z.json({error:"Unauthorized: Invalid token"},{status:401});let{data:s}=await o.from("profiles").select("is_admin").eq("id",n.id).single();if(!s?.is_admin)return d.Z.json({error:"Forbidden: Admin access required"},{status:403});let{searchParams:i}=new URL(e.url),c=i.get("campaign_id"),l=i.get("start_date"),m=i.get("end_date"),g=i.get("format")||"csv";if(!u.supabase)return d.Z.json({error:"Database not configured"},{status:500});let f=u.supabase.from("donations").select(`
        id,
        amount,
        donor_name,
        donor_email,
        status,
        created_at,
        campaigns(title, organizer_id)
      `).eq("status","completed");c&&(f=f.eq("campaign_id",c)),l&&(f=f.gte("created_at",l)),m&&(f=f.lte("created_at",m));let{data:y,error:h}=await f.order("created_at",{ascending:!1});if(h)return console.error("Error fetching donations:",h),d.Z.json({error:"Failed to fetch donation data"},{status:500});if(console.log(`Admin export requested by user ${n.id}:`,{campaignId:c,startDate:l,endDate:m,format:g,recordCount:y?.length||0}),"csv"===g){let e=y?.map(e=>[e.id,e.amount,e.donor_name||"Anonymous",e.donor_email||"",e.campaigns?.title||"",e.status,new Date(e.created_at).toISOString()])||[],t=["Donation ID,Amount,Donor Name,Donor Email,Campaign Title,Status,Date",...e.map(e=>e.map(e=>`"${e}"`).join(","))].join("\n");return new d.Z(t,{status:200,headers:{"Content-Type":"text/csv","Content-Disposition":`attachment; filename="donations-export-${new Date().toISOString().split("T")[0]}.csv"`}})}return d.Z.json({success:!0,data:y,meta:{total:y?.length||0,exported_at:new Date().toISOString(),exported_by:n.id}})}catch(e){return console.error("Export error:",e),d.Z.json({error:"Internal server error"},{status:500})}}let g={...i},f="workUnitAsyncStorage"in g?g.workUnitAsyncStorage:"requestAsyncStorage"in g?g.requestAsyncStorage:void 0;function y(e,t){return"phase-production-build"===process.env.NEXT_PHASE||"function"!=typeof e?e:new Proxy(e,{apply:(e,r,o)=>{let n;try{let e=f?.getStore();n=e?.headers}catch{}return c.wrapRouteHandlerWithSentry(e,{method:t,parameterizedRoute:"/api/admin/export-donors",headers:n}).apply(r,o)}})}let h=y(m,"GET"),I=y(void 0,"POST"),S=y(void 0,"PUT"),E=y(void 0,"PATCH"),b=y(void 0,"DELETE"),v=y(void 0,"HEAD"),x=y(void 0,"OPTIONS"),_=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/export-donors/route",pathname:"/api/admin/export-donors",filename:"route",bundlePath:"app/api/admin/export-donors/route"},resolvedPagePath:"/Users/raoc/Documents/GitHub/Eventraise/app/api/admin/export-donors/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:A,staticGenerationAsyncStorage:w,serverHooks:D,headerHooks:T,staticGenerationBailout:q}=_,O="/api/admin/export-donors/route";function P(){return(0,s.patchFetch)({serverHooks:D,staticGenerationAsyncStorage:w})}},72982:(e,t,r)=>{r.d(t,{supabase:()=>s});var o=r(27354);let n="https://yxzypekwyuopbanroobr.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl4enlwZWt3eXVvcGJhbnJvb2JyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0NjI3NDksImV4cCI6MjA3NDAzODc0OX0.37JNu4brGevL3VDd9In3vxSFY49Jw6CtMZw5SZ6uaEA",s=n&&a?(0,o.eI)(n,a):null;n&&process.env.SUPABASE_SERVICE_ROLE_KEY&&(0,o.eI)(n,process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[2635,3895,7354],()=>r(14609));module.exports=o})();
//# sourceMappingURL=route.js.map